.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" This manpage is Copyright (C) 1992 Drew Eckhardt;
.\"                               1993 Michael Haardt, Ian Jackson.
.\"                               1995 Martin Schulze
.\"
.\" Permission is granted to make and distribute verbatim copies of this
.\" manual provided the copyright notice and this permission notice are
.\" preserved on all copies.
.\"
.\" Permission is granted to copy and distribute modified versions of this
.\" manual under the conditions for verbatim copying, provided that the
.\" entire resulting derived work is distributed under the terms of a
.\" permission notice identical to this one
.\" 
.\" Since the Linux kernel and libraries are constantly changing, this
.\" manual page may be incorrect or out-of-date.  The author(s) assume no
.\" responsibility for errors or omissions, or for damages resulting from
.\" the use of the information contained herein.  The author(s) may not
.\" have taken the same level of care in the production of this manual,
.\" which is licensed free of charge, as they might when working
.\" professionally.
.\" 
.\" Formatted or processed versions of this manual, if unaccompanied by
.\" the source, must acknowledge the copyright and authors of this work.
.\"
.\" Modified Sat Jul 24 13:39:26 1993 by Rik Faith (faith@cs.unc.edu)
.\"
.\" Translated into german by Martin Schulze (joey@infodrom.north.de)
.\"
.TH FCNTL 2 "27. Januar 1996" Linux "Linux Programmierhandbuch"
.SH NAME
fcntl \- File-Descriptor Handling
.SH SYNOPSIS
.nf
.B #include <unistd.h>
.B #include <fcntl.h>
.sp
.BI "int fcntl(int " fd ", int " cmd );
.BI "int fcntl(int " fd ", int " cmd ", long " arg );
.fi
.SH DESCRIPTION
.B fcntl
führt eine von vielen unterschiedlichen Operationen auf dem
File-Deskriptor 
.I fd
aus. Die jeweilige Operation wird durch den Parameter
.I cmd
angegeben:
.TP 0.9i
.B F_DUPFD
Kopiert
.I fd
in
.IR arg , " fd"
wird vorher geschlossen, wenn es nötig ist

Die gleiche Funktionalität kann einfacher mit der Routine
.BR dup2 (2)
erhalten werden.

Die alten und neuen Deskriptoren können ausgetauscht werden. Sie
verwenden beide die gleichen Locks, Positionszeiger und Flags. Wenn
beispielsweise die Dateiposition des einen Deskriptors mit
.B lseek
geändert wird, dann ist sie gleichzeitig auch beim anderen Deskriptor geändert.

Die beiden Deskriptoren teilen sich jedoch nicht das close-on-exec
Flag.

Bei Erfolg wird der neue Deskriptor zurückgegeben.
.TP
.B F_GETFD
Liest das close-on-exec Flag. Wenn das low-order-Bit 0 ist, dann bleibt
die Datei bei einem
.B exec
geöffnet, ansonsten wird sie geschlossen.
.TP
.B F_SETFD
Setzt das close-on-exec Flag auf den Wert, der durch
.I arg
angegeben wurde. (Nur das LSB (Least Significant Bit) wird benutzt.)

.TP
.B F_GETFL
Liest die Flags des Deskriptors. (Alle Flags, die mit 
.BR open (2)
gesetzt werden können, werden zurückgegeben.)
.TP
.B F_SETFL
Setzt die Flags des Deskriptors auf die in
.I arg
angegebenen Werte. Nur
.BR O_APPEND " und " O_NONBLOCK
können gesetzt werden.

Diese Flags werden von allen Kopien eines File-Deskriptors geteilt,
die mit 
.BR dup (2)
o.ä. erzeugt wurden.

Die einzelnen Flags und deren Bedeutung sind in
.BR open (2).
beschrieben.
.TP
.BR F_GETLK ", " F_SETLK " und " F_SETLKW
Behandelt ausschließliche Locks (discretionary file locks).
.TP
.B F_GETOWN
Gibt die Prozeß ID (oder Prozeßgruppe) vom Besitzer eines Sockts zurück.

Prozeßgruppen werden als negative Werte zurückgegeben.
.TP
.B F_SETOWN
Setzt die Prozeß ID oder Prozeßgruppe für den Socket.

Bei diesen Befehlen sind Besitz gleichbedeutend mit dem Empfang von
.B SIGIO
oder
.B SIGURG
Signalen.

Prozeßgruppen werden als negative Werte angegeben..
.SH RÜCKGABEWERTE
Die Rückgabewerte sind abhängig von der ausgeführten Operation:
.TP 0.9i
.B F_DUPFD
Der neue File-Deskriptor.
.TP
.B F_GETFD
Der Inhalt des Flags.
.TP
.B F_GETFL
Der Inhalt der Flags.
.TP
.B F_GETOWN
Der Besetzer des Deskriptors.
.PP
Bei einem Fehler wird \-1 zurückgegeben und 
.I errno
entsprechend gesetzt.
.SH FEHLER
.TP 0.9i
.B EBADF
.I fd
ist kein geöffneter File-Deskriptor.
.TP
.B EINVAL
Bei
.BR F_DUPFD :
.I arg
ist negativ oder größer als der maximal erlaubte Wert.
.TP
.B EMFILE
Bei
.BR F_DUPFD :
Der Prozeß hat bereits das Maximum an File-Deskriptoren geöffnet.
.SH BEMERKUNGEN
Die Fehler, die von 
.BR dup2 (2)
zurückgegeben werden, sind anders als die von 
.BR F_DUPFD .
.SH "ABGESTIMMT MIT"
SVID, AT&T, POSIX, X/OPEN, BSD 4.3.
.SH "AUTOREN"
Drew Eckhardt, Michael Haardt, Ian Jackson und Martin Schulze.
Ins Deutsche übersetzt von Martin Schulze (joey@infodrom.north.de).
.SH "SIEHE AUCH"
.BR open "(2), "
.BR dup2 "(2), "
.BR F_DUPFD "(2), " F_GETFD "(2), " F_GETFL "(2), " F_GETLK "(2), "
.BR socket "(2). "
