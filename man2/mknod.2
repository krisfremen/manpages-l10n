.\" Hey Emacs! This file is -*- nroff -*- source.
.\"
.\" This manpage is Copyright (C) 1992 Drew Eckhardt;
.\"                               1993 Michael Haardt
.\"                               1993,1994 Ian Jackson.
.\" You may distribute it under the terms of the GNU General
.\" Public Licence. It comes with NO WARRANTY.
.\"
.\" Uebersetzung : Lars J. Brandt <ljbrandt@jorma.ping.de>
.TH MKNOD 2 "29 März 1994" "Linux 1.0" "Linux Programmer's Manual"
.SH NAME
mknod \- erstellt eine Spezialdatei
.SH UEBERBLICK
.nf
.B #include <sys/types.h>
.B #include <sys/stat.h>
.B #include <fcntl.h>
.B #include <unistd.h>
.sp
.BI "int mknod(const char *" dateiname ", mode_t " typ ", dev_t " device );
.fi
.SH BESCHREIBUNG
.B mknod
erstellt eine spezielle Datei (FIFO oder named pipe), eine Gerätedatei
für ein zeichenorientiertes Gerät (character device) oder eine 
Gerätedatei für ein blockorientiertes Gerät (block device) mit dem Namen 
.IR dateiname ", spezifiziert durch " typ " und " device .

.I typ
legt zugleich die Zugriffsrechte und die Art der zu erstellenden Datei
fest.
Es sollte eine Verbindung (mit bitweisem ODER) unter der Verwendung 
der weiter unten angegebenen Typen und den Zugriffsrechten für 
die neue Datei sein. 

Die Zugriffsrechte werden normalerweise durch die 
.BR umask
des Prozesses festgelegt; die Zugriffsrechte sind also :
.BR "(typ & ~umask)" .

Hier sind die verschiedenen Typen :
.BR S_IFREG ", " S_IFCHR ", " S_IFBLK " und " S_IFIFO.
Von links nach rechts gelesen ergibt sich als erstes eine normale,
leere Datei, eine Gerätedatei für ein zeichenorientiertes Gerät,
eine Gerätedatei für ein blockorientiertes Gerät und zuletzt
ein FIFO (named pipe).

Bei den Typen 
.BR S_IFCHR " und " S_IFBLK
legt
.I device
die Major- und die Minor Nummer der neu erzeugten Datei fest. Bei den 
anderen Typen wird diese Angabe ignoriert.

Die neu erzeugte Datei läuft unter der effektiven UID des Prozesses
der sie aufruft. Wenn das Verzeichnis in der sich die Datei befindet
aber das SGID-Bit gesetzt hat, oder das Filesystem unter BSD gemountet
ist, erhält die Datei die Gruppenrechte des Verzeichnisses aus dem 
heraus sie aufgerufen wird. 
.SH RUECKGABEWERT 
.BR mknod
meldet bei Erfolg '0', ansonsten wird '-1' zurückgegeben und 
.I errno
entsprechend gesetzt.
.SH FEHLERMELDUNGEN
.TP
.B EPERM
Tritt auf, wenn jemand anderes als der Superuser versucht eine Datei
zu erstellen, die nicht vom Typ FIFO ist.
Kann auch auftreten, wenn das Dateisystem in der die Datei erstellt
werden soll, den angeforderten Dateityp nicht unterstützt.

.TP
.B EINVAL
.IR typ
Es wurde versucht, eine andere Datei als eine normale, eine
Gerätedatei oder eine FIFO zu erstellen.

.TP
.B EEXIST
.IR dateiname
Der angegebene Dateiname existiert bereits.
.TP
.B EFAULT
.IR dateiname " zeigt auf einen ungültigen Adressbereich. "
.TP
.B EACCES
Das Verzeichnis, aus dem heraus die Datei aufgerufen wurde, erlaubt
keinen Schreibzugriff,
oder eins der Verzeichnisse in
.IR dateiname
erlaubt nicht das Ausführen.
.TP
.B ENAMETOOLONG
.IR dateiname " war zu lang."
.TP
.B ENOENT
Ein (oder mehrere) Verzeichnisse im Pfad von 
.I dateiname
existieren nicht, oder es ist ein defekter symbolischer Link
vorhanden.
.TP
.B ENOTDIR
Ein (oder mehrere) Bestandteile im Pfad von
.I dateiname
sind ganz einfach kein Verzeichnis.
.TP
.B ENOMEM
Kein freier Speicher mehr verfügbar.
.TP
.B EROFS
Tritt auf, wenn 
.I dateiname
auf einem Read-Only Filesystem liegt, aber trotzdem Schreibzugriff
verlangt.
.TP
.B ELOOP
.I dateiname
Dateiname zeigt auf einen anderen Dateinamen, der auf sich selbst
zeigt.
.TP
.B ENOSPC
Das Dateisystem (Device) auf dem
.I dateiname
erstellt werden soll, hat keinen Platz mehr frei.
.SH FEHLER 

In manchen alten Linux-Versionen ( z.B. 0.99pl7) erlaubten die
normalen Dateisysteme manchmal die Erstellung von zwei Dateien 
im gleichen Verzeichnis mit gleichem Namen. Dies trat aber nur selten
- und dann nur in extrem (über)belasteten Systemem auf.

Behoben wurde dieser Fehler schon im Minix-Filesystem im Linux 0.99pl8
pre-release und wurde (hoffentlich) in allen anderen Filsystemen kurz
danach auch ausgebügelt. 

.B mknod
kann nicht zur Erstellung von Verzeichnissen oder zur Erzeugung
von Sockets verwendet werden, weiterhin ist es anderen als der Superuserin
nicht möglich, andere Dateien als eine FIFO zu erstellen. 

Es gibt auch noch einige Ungereimtheiten im Zusammenhang mit NFS.
.SH SIEHE AUCH
.BR read "(2), " write "(2), " fcntl "(2), " close (2),
.BR unlink "(2), " open "(2), " mkdir "(2), " stat "(2), " umask (2),
.BR mount "(2), " socket "(2), " socket "(2), " fopen (3).
